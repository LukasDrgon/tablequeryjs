/*

 tablequeryjs by Asim Ihsan (http://www.asimihsan.com)
 https://github.com/asimihsan/tablequeryjs
*/
(function(g,d,q){var f,e,c,l,h={};get_rows_to_display=function(b){console.log("get_rows_to_display.");console.log(b);var a,k=b[0],c=b[1];if(3==b.length)var e=b[2];if(d.isArray(c)){console.log("Interior nodes.");var m=get_rows_to_display(c);if(3==b.length)var g=get_rows_to_display(e);"AND"==k?(console.log("AND"),a=_.intersection(m,g)):"OR"==k?(console.log("OR"),a=_.union(m,g)):"NOT"==k&&(console.log("NOT"),a=_.filter(f.find("tbody tr"),function(a){var b=!1;_.each(m,function(c){d(a).index()==d(c).index()&&
(b=!0)});return!b}))}else{console.log("Child nodes.");switch(k){case "EQ":case "NEQ":var n=RegExp("^"+e+"$");break;case "ILIKE":case "NILIKE":n=RegExp(e,"i");break;case "LIKE":case "NLIKE":n=RegExp(e)}var l="N"!=k.substring(0,1);if(c in h){console.log("left value in table_headings.");var p=h[c];a=f.find("tbody tr").filter(function(a){text=d(this).children()[p].textContent;regexp_result=n.test(text);return l?regexp_result:!regexp_result})}}a||(console.log("no return value, return all rows."),a=f.find("tbody tr"));
console.log("returning");console.log(a);return a};parse_search_text=function(b){var a=!0,c;try{c=grammar.parse(b)}catch(d){a=!1}return{rc:a,parsed_query:c}};update_table_search_text_warning=function(b){0==e.val().length?(c.removeClass("error"),c.removeClass("success")):b?(c.removeClass("error"),c.addClass("success")):(c.addClass("error"),c.removeClass("success"))};maybe_update_table_headings=function(){_.isEmpty(h)&&(d.map(f.find("th"),function(b,a){h[b.textContent.toLowerCase()]=a}),console.log(h))};
g.set_table=function(b){f=d(b)};g.set_table_search_text=function(b){e=d(b);c=e.closest(".control-group");e.keyup(function(a){maybe_update_table_headings();if(d(this).val()==l)return!1;a=parse_search_text(d(this).val());update_table_search_text_warning(a.rc);a.rc?(a=get_rows_to_display(a.parsed_query),f.find("tbody tr").hide(),_.each(a,function(a){d(a).show()}),console.log(a)):f.find("tbody tr").show();l=d(this).val()});e.keypress(function(a){return 13!==(a.keyCode||a.which||a.charCode||0)})}})(window.tablequery=
window.tablequery||{},jQuery);
