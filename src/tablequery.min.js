/*

 tablequeryjs by Asim Ihsan (http://www.asimihsan.com)
 https://github.com/asimihsan/tablequeryjs
*/
(function(l,e,q){var g,h,c,d,f,m={};get_rows_to_display=function(b){console.log("get_rows_to_display.");console.log(b);var a,k=b[0],c=b[1];if(3==b.length)var d=b[2];if(e.isArray(c)){console.log("Interior nodes.");var f=get_rows_to_display(c);if(3==b.length)var g=get_rows_to_display(d);"AND"==k?(console.log("AND"),a=_.intersection(f,g)):"OR"==k?(console.log("OR"),a=_.union(f,g)):"NOT"==k&&(console.log("NOT"),a=_.filter(h,function(a){var b=!1;_.each(f,function(c){e(a).index()==e(c).index()&&(b=!0)});
return!b}))}else{console.log("Child nodes.");switch(k){case "EQ":case "NEQ":var n=RegExp("^"+d+"$");break;case "ILIKE":case "NILIKE":n=RegExp(d,"i");break;case "LIKE":case "NLIKE":n=RegExp(d)}var l="N"!=k.substring(0,1);if(c in m){console.log("left value in table_headings.");var p=m[c];a=h.filter(function(a){text=e(this).children()[p].textContent;regexp_result=n.test(text);return l?regexp_result:!regexp_result})}}a||(console.log("no return value, return all rows."),a=h);console.log("returning");console.log(a);
return a};get_rows_to_display=_.memoize(get_rows_to_display);parse_search_text=function(b){var a=!0,c;try{c=grammar.parse(b)}catch(d){a=!1}return{rc:a,parsed_query:c}};update_table_search_text_warning=function(b){0==c.val().length?(d.removeClass("error"),d.removeClass("success")):b?(d.removeClass("error"),d.addClass("success")):(d.addClass("error"),d.removeClass("success"))};update_table_headings=function(){e.map(g.find("th"),function(b,a){m[b.textContent.toLowerCase()]=a});console.log(m)};l.set_table=
function(b){g=e(b);h=g.find("tbody tr");update_table_headings()};l.set_table_search_text=function(b){c=e(b);d=c.closest(".control-group");c.keyup(function(a){if(e(this).val()==f)return!1;a=parse_search_text(e(this).val());update_table_search_text_warning(a.rc);a.rc?(a=get_rows_to_display(a.parsed_query),h.hide(),_.each(a,function(a){e(a).show()}),console.log(a)):h.show();f=e(this).val();Modernizr.localstorage&&(localStorage.previous_search_text=f)});c.keypress(function(a){return 13!==(a.keyCode||
a.which||a.charCode||0)});Modernizr.localstorage&&(c.val(localStorage.previous_search_text),f=c.val(),c.keyup())}})(window.tablequery=window.tablequery||{},jQuery);
