/*

 tablequeryjs by Asim Ihsan (http://www.asimihsan.com)
 https://github.com/asimihsan/tablequeryjs
*/
(function(m,f,q){var k,l,b,c,a=[],n={};get_rows_to_display=function(g){console.log("get_rows_to_display.");console.log(g);var d,e=g[0],b=g[1];if(3==g.length)var a=g[2];if(f.isArray(b)){console.log("Interior nodes.");var c=get_rows_to_display(b);if(3==g.length)var k=get_rows_to_display(a);"AND"==e?(console.log("AND"),d=_.intersection(c,k)):"OR"==e?(console.log("OR"),d=_.union(c,k)):"NOT"==e&&(console.log("NOT"),d=_.filter(l,function(e){var b=!1;_.each(c,function(a){f(e).index()==f(a).index()&&(b=!0)});
return!b}))}else{console.log("Child nodes.");switch(e){case "EQ":case "NEQ":var h=RegExp("^"+a+"$");break;case "ILIKE":case "NILIKE":h=RegExp(a,"i");break;case "LIKE":case "NLIKE":h=RegExp(a)}var m="N"!=e.substring(0,1);if(b in n){console.log("left value in table_headings.");var p=n[b];d=l.filter(function(e){text=f(this).children()[p].textContent;regexp_result=h.test(text);return m?regexp_result:!regexp_result})}}d||(console.log("no return value, return all rows."),d=l);console.log("returning");console.log(d);
return d};get_rows_to_display=_.memoize(get_rows_to_display);parse_search_text=function(b){var a=!0,e;try{e=grammar.parse(b)}catch(c){a=!1}return{rc:a,parsed_query:e}};update_table_search_text_warning=function(a,d){0==b.val().length||d?(c.removeClass("error"),c.removeClass("success")):a?(c.removeClass("error"),c.addClass("success")):(c.addClass("error"),c.removeClass("success"))};update_table_headings=function(){f.map(k.find("th"),function(a,b){n[a.textContent.toLowerCase()]=b});console.log(n)};m.set_table=
function(a){k=f(a);l=k.find("tbody tr");update_table_headings()};var h;m.set_table_search_text=function(g){b=f(g);c=b.closest(".control-group");table_search_text_on_keyup=function(a,b){var c=parse_search_text(b);update_table_search_text_warning(c.rc,!1);c.rc?(h=!1,c=get_rows_to_display(c.parsed_query),l.hide(),_.each(c,function(a){f(a).show()}),console.log(c),update_previous_search_text()):(h||l.show(),h=!0)};table_search_text_on_keyup_debounced=_.debounce(table_search_text_on_keyup,500);b.keyup(function(a){table_search_text_on_keyup_debounced(a,
b.val())});b.keypress(function(a){return 13!==(a.keyCode||a.which||a.charCode||0)});update_previous_search_text=function(){_.contains(a,b.val())||(a.push(b.val()),5<a.length&&(a=a.slice(1)),Modernizr.localstorage&&(localStorage.previous_search_text=JSON.stringify(a),b.autocomplete({source:a,minLength:0})))};if(Modernizr.localstorage){try{a=JSON.parse(localStorage.previous_search_text)}catch(d){a=[]}_.each(a,function(a){a=parse_search_text(a);a.rc&&get_rows_to_display(a.parsed_query)});b.autocomplete({source:a,
minLength:0,select:function(a,b){}});b.on("autocompleteselect",function(a,b){table_search_text_on_keyup(null,b.item.value)});b.click(function(){b.autocomplete("search","")});0<a.length&&(b.val(a[a.length-1]),table_search_text_on_keyup(null,b.val()))}}})(window.tablequery=window.tablequery||{},jQuery);
