/*

 tablequeryjs by Asim Ihsan (http://www.asimihsan.com)
 https://github.com/asimihsan/tablequeryjs
*/
(function(h,f,q){var e,g,a,c,b=[],k={};get_rows_to_display=function(a){console.log("get_rows_to_display.");console.log(a);var d,b=a[0],l=a[1];if(3==a.length)var c=a[2];if(f.isArray(l)){console.log("Interior nodes.");var e=get_rows_to_display(l);if(3==a.length)var h=get_rows_to_display(c);"AND"==b?(console.log("AND"),d=_.intersection(e,h)):"OR"==b?(console.log("OR"),d=_.union(e,h)):"NOT"==b&&(console.log("NOT"),d=_.filter(g,function(d){var a=!1;_.each(e,function(b){f(d).index()==f(b).index()&&(a=!0)});
return!a}))}else{console.log("Child nodes.");switch(b){case "EQ":case "NEQ":var m=RegExp("^"+c+"$");break;case "ILIKE":case "NILIKE":m=RegExp(c,"i");break;case "LIKE":case "NLIKE":m=RegExp(c)}var n="N"!=b.substring(0,1);if(l in k){console.log("left value in table_headings.");var p=k[l];d=g.filter(function(d){text=f(this).children()[p].textContent;regexp_result=m.test(text);return n?regexp_result:!regexp_result})}}d||(console.log("no return value, return all rows."),d=g);console.log("returning");console.log(d);
return d};get_rows_to_display=_.memoize(get_rows_to_display);parse_search_text=function(a){var d=!0,b;try{b=grammar.parse(a)}catch(c){d=!1}return{rc:d,parsed_query:b}};update_table_search_text_warning=function(b,d){0==a.val().length||d?(c.removeClass("error"),c.removeClass("success")):b?(c.removeClass("error"),c.addClass("success")):(c.addClass("error"),c.removeClass("success"))};update_table_headings=function(){f.map(e.find("th"),function(a,d){k[a.textContent.toLowerCase()]=d});console.log(k)};h.set_table=
function(a){e=f(a);g=e.find("tbody tr");update_table_headings()};h.set_table_search_text=function(e){a=f(e);c=a.closest(".control-group");table_search_text_on_keyup=function(a,b){var c=parse_search_text(b);update_table_search_text_warning(c.rc,!1);c.rc?(c=get_rows_to_display(c.parsed_query),g.hide(),_.each(c,function(a){f(a).show()}),console.log(c),update_previous_search_text()):g.show()};table_search_text_on_keyup_debounced=_.debounce(table_search_text_on_keyup,500);a.keyup(function(d){update_table_search_text_warning(null,
!0);table_search_text_on_keyup_debounced(d,a.val())});a.keypress(function(a){return 13!==(a.keyCode||a.which||a.charCode||0)});update_previous_search_text=function(){_.contains(b,a.val())||(b.push(a.val()),5<b.length&&(b=b.slice(1)),Modernizr.localstorage&&(localStorage.previous_search_text=JSON.stringify(b),a.autocomplete({source:b,minLength:0})))};Modernizr.localstorage&&(b=JSON.parse(localStorage.previous_search_text),_.each(b,function(a){a=parse_search_text(a);a.rc&&get_rows_to_display(a.parsed_query)}),
a.autocomplete({source:b,minLength:0,select:function(a,b){}}),a.on("autocompleteselect",function(a,b){table_search_text_on_keyup(null,b.item.value)}),a.click(function(){a.autocomplete("search","");table_search_text_on_keyup(null,a.val())}),0<b.length&&(a.val(b[b.length-1]),table_search_text_on_keyup(null,a.val())))}})(window.tablequery=window.tablequery||{},jQuery);
